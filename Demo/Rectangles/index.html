<!DOCTYPE html>
<html> 
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <script type="text/javascript" src="../../j2ds/j2ds.js"></script>
  <title>html5 page</title>
 </head>

 <body>
<!--// this is body of HTML-doc //-->
<canvas id="fpsTest" width="400" height="400"></canvas>

<script type="text/javascript">
// объявление объектов
var scene= j2ds.scene;
var input= j2ds.input;

// инициализация сцены
scene.init('fpsTest');

// если требуется развернуть сцену на весь экран
//scene.fullScreen(true);

// кол-во прямоугольников
var nodesCount= 0;
var nodes= [];

// объявление игровой функции
var fpsTest= function () {

 // очистка сцены перед отрисовкой
 scene.clear();

 // если нажата ЛКМ или ТАЧ, создаем прямоугольники
 if (input.lClick) {
  for (var n= 0; n<10; n+=1) {
   // Добавляем зеленый прямоугольник
   var o= scene.addRectNode(input.pos, vec2df(10, 10), 'green');
   // устанавливаем ему скорость смещения
   o.dx= 6-Random(0, 12); o.dy= 6-Random(0, 12);
   // пушим его в массив прямоугольников
   nodes.push(o);
   // увеличиваем счетчик прямоугольников (он равен nodes.length)
   nodesCount= nodes.length; 
  }
 }

 // обработка прямоугольников
 for (var i= 0; i < nodesCount; i+=1) {
  // двигаем прямоугольник в соответствии с его переменными скоростей
  nodes[i].move(vec2di(nodes[i].dx, nodes[i].dy));
  // рисуем прямоугольник
  nodes[i].draw();
  // если нельзя позволить прямоугольнику выйти за пределы сцены
  //if (nodes[i].isCollisionScene().x) nodes[i].dx*= (-1);
  //if (nodes[i].isCollisionScene().y) nodes[i].dy*= (-1);
  // Если произошло столкновение с границей сцены в любом месте
  if (nodes[i].isCollisionScene().all) {
   // уничтожаем 1 прямоугольник, который столкнулся
   nodes.splice(i, 1);
   // и обновляем счетчик
   nodesCount= nodes.length;
   // переходим к обработке след. прямоугольника
   continue;
  }
 } 
 // Выводим количество прямоугольников
 scene.drawText(vec2di(10, 10), 'Прямоугольники: '+ nodesCount);
};

// После объъявления всех функций стартуем сцену
scene.start(fpsTest, 60);
</script>

<!--// end of HTML-doc //-->
 </body>
</html>